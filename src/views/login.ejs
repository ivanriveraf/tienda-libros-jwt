<%- include('layout', { body: `
  <div class="row justify-content-center">
    <div class="col-md-4">
      <h2 class="mb-3 text-success text-center">Login</h2>
      <form id="formLogin">
        <div class="mb-3">
          <label class="form-label">Usuario</label>
          <input type="text" name="username" class="form-control" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Contraseña</label>
          <input type="password" name="password" class="form-control" required />
        </div>
        <button class="btn btn-success w-100">Ingresar</button>
      </form>
      <p class="mt-3 text-center">
        ¿No tienes cuenta?
        <a href="/registro" class="text-success">Regístrate</a>
      </p>
      <div id="loginMsg" class="mt-2"></div>
    </div>
  </div>

  <script>
    const formLogin = document.getElementById('formLogin');

    formLogin.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(formLogin));

      const res = await fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      const json = await res.json();
      const msg = document.getElementById('loginMsg');

      if (json.token) {
        msg.innerHTML =
          '<div class="alert alert-success alert-dismissible fade show" role="alert">' +
            '<strong>Login correcto.</strong> Bienvenido nuevamente.' +
            '<button type="button" class="btn-close" data-bs-dismiss="alert"></button>' +
          '</div>';

        localStorage.setItem('token', json.token);

        // Redirigir a /libros después de 1 segundo
        setTimeout(function () {
          window.location.href = '/libros';
        }, 1000);
      } else {
        msg.innerHTML =
          '<div class="alert alert-danger alert-dismissible fade show" role="alert">' +
            (json.msg || 'Error al iniciar sesión') +
            '<button type="button" class="btn-close" data-bs-dismiss="alert"></button>' +
          '</div>';
      }
    });
  </script>
` }) %>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Tienda de Libros JWT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="/css/styles.css" />
</head>
<body class="bg-dark text-light">
  <nav class="navbar navbar-expand-lg navbar-dark bg-black border-bottom border-success">
    <div class="container-fluid">
      <a class="navbar-brand text-success" href="/">Tienda Libros</a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNav"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
       <ul class="navbar-nav ms-auto" id="navLinks">
         <li class="nav-item"><a href="/libros" class="nav-link">Libros</a></li>
         <li class="nav-item"><a href="/login" class="nav-link">Login</a></li>
        <li class="nav-item"><a href="/registro" class="nav-link">Registro</a></li>
        <li class="nav-item">
    <a href="#" class="nav-link" onclick="logout(event)">Logout</a>
  </li>
</ul>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    <%- body %>
  </main>

  <div class="container mt-2" id="globalMsg"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
  function logout(e) {
    if (e) e.preventDefault();

    const msg = document.getElementById('globalMsg');
    const token = localStorage.getItem('token');

    // Caso 1: NO hay sesión iniciada
    if (!token) {
      msg.innerHTML = `
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
          <strong>No hay sesión activa.</strong>
          Inicia sesión para acceder a la tienda.
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      `;
      return;
    }

    // Caso 2: SÍ hay sesión y la cerramos
    localStorage.removeItem('token');

    msg.innerHTML = `
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <strong>Sesión cerrada correctamente.</strong>
        Gracias por visitar la Tienda de Libros.
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    `;

    // Redirigir después de 1.5 segundos
    setTimeout(() => {
      window.location.href = '/';
    }, 1500);
  }
</script>

<script>
  function renderNav() {
    const nav = document.getElementById('navLinks');
    const token = localStorage.getItem('token');

    if (token) {
      // Usuario logueado
      nav.innerHTML = `
        <li class="nav-item"><a href="/libros" class="nav-link">Libros</a></li>
        <li class="nav-item">
          <a href="#" class="nav-link text-warning" onclick="logout(event)">Cerrar sesión</a>
        </li>
      `;
    } else {
      // Usuario sin sesión
      nav.innerHTML = `
        <li class="nav-item"><a href="/libros" class="nav-link">Libros</a></li>
        <li class="nav-item"><a href="/login" class="nav-link">Login</a></li>
        <li class="nav-item"><a href="/registro" class="nav-link">Registro</a></li>
      `;
    }
  }

  // Ejecutar cuando cargue la página
  renderNav();
</script>


</body>
</html>
